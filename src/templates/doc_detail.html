{% extends "index.html" %}
{% block content %}

<h1>{{ documents.title }}</h1> 
<table width="100%" >
<tr>
  <td>
    <table>
    
      {% if change_document %}
        <tr>
          <td>
            <form action="" method="post">
		          <input type="submit" name="edit" value="Editieren" />
	          </form>
	        </td>
	      </tr>
	    {% endif %}
      <tr>
		  <td><b>Status:  </b></td> 
		  <td>
{% if documents.status == 0 %}
         Vorhanden
{% endif %}     
{% if documents.status == 1 %}
    Ausgeliehen
{% endif %} 
{% if documents.status == 2 %}
    Bestellt
{% endif %} 
{% if documents.status == 3 %}
    Vermisst
{% endif %} 
{% if documents.status == 4 %}
    Verloren
{% endif %} 
</td>
		</tr>

  
	  
	  <tr>
		  <td><b>Autor:</b></td>
		  <td>
			{% for a in documents.authors.all %}
			{{ a.first_name }} {{ a.last_name }},
			{% endfor %}
		  </td>
		</tr>
		
		<tr>
		  <td><b>Kategorie:</b></td>
		  <td>{{ documents.category }}</td>
		</tr>
		
		<tr>
		  <td><b>Publisher:</b></td>
		  <td>
			{% if documents.publisher %}
			{{ documents.publisher }}
			{% else %}
			-
			{% endif %}
		  </td>
		</tr>
		
		<tr>
		  <td><b>Erscheinungsjahr:</b></td>
		  <td>{{ documents.year }}</td>
		</tr>
		
		<tr>
		  <td><b>Schlüsselwörter:</b></td>
		  <td>
			<!-- TODO funktioniert vermutlich auch noch nicht wirklich -->
			{{ key_len }}
			{% if key_len > 0 %}
			{% for k in documents.keywords_set.all %}
			{{ k.keyword }}{% if not forloop.last %},
			{% endif %}
			{% endfor %}
			{% else %}
			-
			{% endif %}
		  </td>
		</tr>
		
		{% if cs_dop %}	    
		<tr>
		  <td><b>In der Bibliothek seit:</b></td>
		  <td>{{ documents.date_of_purchase }}</td>
		</tr>
		{% endif %}
		<tr>
		  <td><b>Notizen:</b></td>
		  <td>
			{% if documents.comment %}
			{{ documents.comment }}
			{% else %}
			-
			{% endif %}
		  </td>
		</tr>
		
		{% for de in doc_extra %}    
		<tr>
		  <td> {% if de.bib_field == "volume" %}
		  <b>Umfang:</b>
		  {% else %}
		  <b>
		  {{ de.bib_field }}</b>
		  {% endif %}
		  </td>
		  <td>{{ de.content }}</td>
		</tr>
		{% endfor %}
		
		<tr>
		  <td><b>ID in der Bibliothek:</b></td>
		  <td>{{ documents.bib_no }}</td>
		</tr>
		
		<tr>
		  <td><b>Inventarnummer:</b></td>
		  <td>{{ documents.inv_no }}</td>
		</tr>
		
		<tr>
		  <td><b>ISBN:</b></td>
		  <td>
			{% if documents.isbn %}
			{{ documents.isbn }}
			{% else %}
			-
			{% endif %}
		  </td>
		</tr>
		
    {% if cs_price %}
		<tr>
		<td><b>Preis:</b></td>
		  <td>
			{% if documents.price and documents.currency %}
			{{ documents.price }}{{ documents.currency }}
			{% else %}
			-
			{% endif %}
		  </td>
		</tr>
		{% endif %}  
		
		<tr>
		  <td><b>BibTeX-ID:</b></td>
		  <td>{{ documents.bibtex_id }}</td>
		</tr>
		
		{% if cs_locn %}
		<tr>
		  <td><b>LibraryOfCongressN:</b></td>
		  <td>
			{% if documents.lib_of_con_nr %}
			{{ documents.lib_of_con_nr }}
			{% else %}
			-
			{% endif %}
		  </td>
		</tr>
		{% endif %}
		
		{% if cs_lui %}
		<tr>
		    <td><b>Zuletzt bearbeitet am: </b></td>
		    <td> {{ documents.last_updated }} </td>
		</tr>
		<tr>
		    <td><b>Zuletzt bearbeitet von: </b></td>
		    <td> {{ documents.last_edit_by }} </td>
		</tr>
		{% endif %}
		
		</table>
	</td>
	
	<td>
	{% if user.is_authenticated %}
	  {% if documents.status == 0 %}
	    {% if c_le %}
	      <form action="" method="post">
		      <input type="submit" name="lend" value="Ausleihen" /> 
	      </form><br />
	      {# <!-- Ausleihe an externen --> #}
	      
	    {% endif %}
	    {% if c_mi %}
	      <form action="" method="post">
		    <input type="submit" name="missing" value="Vermisst melden" /> <br />
	      </form><br />
	    {% endif %}
	    
	  {% else %}
	    {% if documents.status == 1 %}    
	      {% if lending %}
	        {% if lending.non_user_lend %}
	          {# <!-- TODO Profillinks einfügen --> #}
	          Das Dokument ist von {{ lending.non_user_lend.first_name }} {{ lending.non_user_lend.last_name }} ausgeliehen. <br />
	          {% if user.id == lending.user_lend.id %}
	            Als Bürge sind Sie eingetragen.
	          {% else %}
	            Als Bürge fungiert <a href="/user/{{ lending.user_lend.id }}">{{ lending.user_lend.first_name }} {{ lending.user_lend.last_name }}</a>. <br />
	          {% endif %}
	        {% else %}
	          {% if user.id == lending.user_lend.id %}
	            Das Dokument wurde bereits von Ihnen ausgeliehen. <br />
	          {% else %}
	            {% if lending.user_lend.first_name %}
	              {% if lending.user_lend.last_name %}
	                Das Dokument ist von <a href="/user/{{ lending.user_lend.id }}">{{ lending.user_lend.first_name }} {{ lending.user_lend.last_name }}</a> ausgeliehen. <br />
	              {% else %}
	                Das Dokument ist vom User <a href="/user/{{ lending.user_lend.id }}">{{ lending.user_lend.username }}</a> ausgeliehen. <br />
                {% endif %}
              {% else %}
                  Das Dokument ist vom User <a href="/user/{{ lending.user_lend.id }}">{{ lending.user_lend.username }}</a> ausgeliehen. <br />
	            {% endif %}
	          {% endif %}
	        {% endif %}
	        {% if c_le %}
	          {% if lending.user_lend.id != user.id %}
	            <form action="" method="post" >
	              <input type="submit" name="lend" value="&Uuml;bertragen" /> <br />
	            </form>  
	          {% else %}
			        <form action="{{documents.bib_no}}/assign" method="post" >
	              <input type="submit" name="assign" value="&Uuml;bertragen" /> <br />
	            </form>
	            {# <!-- TODO Ausleihe an externen --> #}
	            
	          {% endif %}
	        {% endif %}
	        {% if c_ule %}
	          {% if lending.user_lend == user %}
	            <form action="" method="post">
	              <input type="submit" name="restitution" value="R&uuml;ckgabe" />
	            </form><br />
	            {# <!-- TODO übertragen vom ausleihenden aus --> #}
	          {% endif %}
	        {% endif %}
	        {% if c_mi %}
	          <form action="" method="post">
		          <input type="submit" name="missing" value="Vermisst melden" />
	          </form><br />
	        {% endif %}
	      {% endif %}
	      
	    {% else %}
	      {% if documents.status == 2 %}
	        Das gewünschte Dokument ist derzeit erst bestellt und steht noch nicht zur Ausleihe bereit. <br />
	        {% if c_order %}
	          <form action="" method="post">
	            <input type="submit" name="restitution" value="Ist angekommen" />
	          </form><br />
	        {% endif %}
	        
	      {% else %}
	        {% if documents.status == 3 %}
	          Das gewünschte Dokument wurde vor kurzem vermisst gemeldet. <br />
	          <!-- TODO Mail an den Bibliothekar wenn gefunden -->
	          {% if c_mi %}
	            <form action="" method="post">
		            <input type="submit" name="found" value="Gefunden melden" />
	            </form><br />
	          {% endif %}
	          {% if c_lo %}
	            <form action="" method="post">
	              <input type="submit" name="lost" value="als verloren markieren" />
	            </form><br />
	          {% endif %}
	          
	        {% else %}
	          Dieses Dokument gilt als verloren. <br />
	          {# <!-- TODO wer genau kann verlorene als wiedergefunden melden (derzeit nur solche mit dem Recht des auch Verloren-setzens --> #}
	          {% if c_lo %}
	            <form action="" method="post">
	              <input type="submit" name="found" value="Gefunden melden" />
	            </form><br />
	          {% endif %}
	        {% endif %}  
	      {% endif %}
	    {% endif %}
	  {% endif %}
	{% endif %}
	</td>
  </tr>
</table>

<input type="button" name="bibtex" value="BibTeX" onclick="spoiler(this,'spoiler','BibTeX','BibTeX verbergen')"> <br />
<div id="spoiler" name="spoiler" style="display: none;"><textarea cols="63"
	rows="15" readonly="true">{{ bi }}</textarea></div>
	
{% if cs_history %}
<h3>History dieses Dokuments</h3>





    
    
    
    <table width = "80%", rules="rows">
    {% for r in history %}
    <tr><td>{{ r.date }} </td>   
    
    <td>{% if r.status == 0 %}
         Zurück gegeben
{% endif %}
     
{% if r.status == 1 %}
    Ausgeliehen
{% endif %} 
{% if r.status == 2 %}
    Bestellt
{% endif %} 
{% if r.status == 3 %}
    Vermisst
{% endif %} 
{% if r.status == 4 %}
    Verloren
{% endif %}  </td>  
    <td>{{ r.recent_user }} </td> 
    </tr>
    
    {% endfor %}
    </table>





{% endif %}
    
    
{% endblock %}
